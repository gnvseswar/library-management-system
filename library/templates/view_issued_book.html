{% extends 'admin_navbar.html' %}
{% load static %}
{% block title %} All Issued Books {% endblock %}
{% block css %}
<style>
    .badge {
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 14px;
    }
    .badge-success {
        background-color: #28a745;
        color: white;
    }
    .badge-warning {
        background-color: #ffc107;
        color: black;
    }
    .badge-info {
        background-color: #17a2b8;
        color: white;
    }
    .feedback-text {
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .star-rating {
        color: #ffc107;
    }
</style>
{% endblock %}
{% block body %}
<div class="container mt-4">
    <h1 class="text-center"><u>All Issued Books</u></h1>
    <table class="table table-hover" id="example">
        <thead>
            <tr class="text-center">
                <th>Sr.No</th>
                <th>Student</th>
                <th>Student ID</th>
                <th>Book Name</th>
                <th>ISBN</th>
                <th>Issued Date</th>
                <th>Expiry Date</th>
                <th>Return Date</th>
                <th>Status</th>
                <th>Fine</th>
                <th>Rating</th>
                <th>Feedback</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for i in details %}
            <tr class="text-center">
                <td>{{forloop.counter}}.</td>
                <td>{{i.0}}</td>
                <td>{{i.1}}</td>
                <td>{{i.2}}</td>
                <td>{{i.3}}</td>
                <td>{{i.4}}</td>
                <td>{{i.5}}</td>
                <td>{{i.6|default:"Not Returned"}}</td>
                <td>
                    {% if i.8 == 'RETURNED' %}
                        <span class="badge badge-success">{{i.8}}</span>
                    {% elif i.8 == 'ISSUED' %}
                        <span class="badge badge-warning">{{i.8}}</span>
                    {% endif %}
                </td>
                <td>₹ {{i.7}}</td>
                <td>
                    {% if i.9 %}
                        <div class="star-rating">
                            {% for _ in ''|ljust:i.9 %}★{% endfor %}
                            {% for _ in ''|ljust:5|slice:i.9 %}☆{% endfor %}
                        </div>
                    {% else %}
                        {% if i.8 == 'RETURNED' %}
                            <span class="badge badge-info">Pending</span>
                        {% else %}
                            -
                        {% endif %}
                    {% endif %}
                </td>
                <td>
                    {% if i.10 %}
                        <span class="feedback-text" title="{{i.10}}">{{i.10}}</span>
                    {% else %}
                        {% if i.8 == 'RETURNED' %}
                            <span class="badge badge-info">Pending</span>
                        {% else %}
                            -
                        {% endif %}
                    {% endif %}
                </td>
                <td><a href="/delete_issue/{{i.11}}/" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this record?')">Delete</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
